<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-04-07">

<title>iaingallagher.github.io - Bayes rule &amp; distributions; Inference with conjugate priors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">iaingallagher.github.io</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Bayes rule &amp; distributions; Inference with conjugate priors</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Bayes</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 7, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the <a href="https://iaingallagher.github.io/posts/bayes_two_grid_approx/Bayes_part_2_grid_estimation.html">last post</a> we used Bayes theorem and grid approximation to estimate the probability of 4 different hypotheses about the proportion of students achieving a high mark in an undergraduate course. Specifically we examined proportions of 5%, 10%, 15% &amp; 20%. For each proportion (hypothesis) we set a prior probability distribution <span class="math inline">\(P(H)\)</span>, used the binomial distribution to calculate the likelihood of the data we had for each of the prior probabilities, multiplied the prior probabilities and the likelihoods together and finally calculated the posterior distribution by dividing these products by their combined sum. Grid approximation is useful to see how the moving parts work but it doesn’t scale well and it’s not useful if we are dealing with continuous priors &amp; likelihoods. For the student marks data we might want to consider <strong>any</strong> proportion for first class marks from 0 to 1.</p>
</section>
<section id="conjugate-distributions" class="level1">
<h1>Conjugate distributions</h1>
<p>Sometimes we can derive the posterior distribution really easily (and exactly) with relatively simple algebra &amp; some basic arithmetic. This is the idea behind <em>conjugate distributions</em>. Recall that we start a Bayesian analysis with a prior distribution which reflects the plausibility of a parameter before we see any data. We collect data and combine the data with the prior through the likelihood. The posterior distribution is the product of the prior and the likelihood. For some combinations of priors and likelihoods the posterior ends up being the <em>same kind of distribution</em> as the prior. This property is called conjugacy - the prior distribution is said to be conjugate to the posterior distribution. Conjugate priors can be used for some simple analyses and they greatly simplify the process of going from prior to posterior. In this post we’ll illustrate how conjugacy works by repeating the analysis of student marks; however instead of a grid of discrete proportions (i.e.&nbsp;5%, 10%, 15% &amp; 20%) we’ll consider any proportion from 0-100%.</p>
<section id="the-binomial-distribution" class="level2">
<h2 class="anchored" data-anchor-id="the-binomial-distribution">The Binomial Distribution</h2>
<p>The Binomial distribution tells us the probability of getting <span class="math inline">\(s\)</span> successes in <span class="math inline">\(n\)</span> trials if the probability of success is <span class="math inline">\(\theta\)</span>. Here success is defined (non-judgmentally) as a first class mark; &gt;70% in the UK university system. The formula for the Binomial probability distribution is:</p>
<p><span class="math inline">\(P(s) = {n \choose s}\theta^s(1-\theta)^{n-s}\)</span></p>
<p>The <span class="math inline">\({n\choose s}\)</span> part is called the binomial coefficient and is calculated by <span class="math inline">\(\frac{n!}{s!(n-s)!}\)</span>. The <span class="math inline">\(!\)</span> means factorial - <span class="math inline">\(4! = 4 \times 3 \times 2 \times 1\)</span>.</p>
<ul>
<li><span class="math inline">\(s\)</span> is the number of successes</li>
<li><span class="math inline">\(n\)</span> is the total number of trials</li>
<li><span class="math inline">\(\theta\)</span> is the proportion (or probability) of success</li>
</ul>
<p>The Binomial distribution is a discrete distribution because the number of trials (<span class="math inline">\(n\)</span>) and the number of successes (<span class="math inline">\(s\)</span>) can only be integers. In the current analysis the binomial distribution is useful in the <em>likelihood</em> function because in any set of trials the number of successes and failures will be integers.</p>
<p>We’re going to combine the Binomial likelihood with some prior distribution to estimate the proportion of successes. The prior distribution over the proportion of successes should therefore be continuous - any proportion between 0% and 100% is possible!</p>
</section>
<section id="the-beta-distribution" class="level2">
<h2 class="anchored" data-anchor-id="the-beta-distribution">The Beta Distribution</h2>
<p>We want a prior distribution that spans the range [0,1]. The continuous distribution for conjugacy in this context is the <em>Beta distribution</em>.</p>
<p>The Beta distribution has two parameters, <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and is denoted as <span class="math inline">\(Beta(a,b)\)</span>. The density of the Beta distribution over a parameter, <span class="math inline">\(\theta\)</span> has the form:</p>
<p><span class="math display">\[p(\theta| a,\ b) = \frac{\theta^{a-1}(1-\theta)^{b-1}}{B(a,b)}\]</span></p>
<p>where <span class="math inline">\(B(a,b)\)</span> is the Beta <em>function</em> (not distribution) and acts as the normalising constant to ensure the area under the curve of the distribution sums to 1. The Beta function is:</p>
<p><span class="math display">\[B(a,\ b) = \int_0^1 d\theta\ \theta^{a-1}(1-\theta)^{b-1}\]</span></p>
<p>If we use a Beta prior and a Binomial likelihood the prior and the likelihood share some mathematical form and the resulting posterior is conjugate to the prior. This just means it’s easy to calculate the posterior distribution. The ‘same mathematical form’ parts of the Binomial &amp; Beta distributions are shown in the figure below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pics/binom_beta.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption class="figure-caption">Beta-Binomial mathematical form equivalence</figcaption><p></p>
</figure>
</div>
<p>In both distributions we have <span class="math inline">\(\theta\)</span> raised to some power and <span class="math inline">\(1-\theta\)</span> raised to some power. This mathematical equivalence makes it easy to combine the prior and likelihood to form a posterior distribution.</p>
<section id="calculating-the-posterior" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-posterior">Calculating the posterior</h3>
<p>Bayes rule is:</p>
<p><span class="math display">\[P(\theta|data) = \frac{P(data|\theta)P(\theta)}{P(data)}\]</span></p>
<p>Here <span class="math inline">\(\theta\)</span> is a placeholder for the proportion we are trying to estimate.</p>
<p>We calculate the posterior distribution for <span class="math inline">\(\theta\)</span> by multiplying the prior (here a <span class="math inline">\(Beta(a,b)\)</span> distribution) by the likelihood - <span class="math inline">\(P(data|\theta)\)</span> - here a binomial distribution.</p>
<p>The advantage of using a conjugate prior is that it simplifies the mathematics. In this case we have (ignoring the normalising constant in the denominator):</p>
<p><span class="math display">\[{n \choose s}\theta^s(1-\theta)^{n-s} \times \theta^{a-1}(1-\theta)^{b-1}\]</span></p>
<p>Since we’re multiplying the same quantities (<span class="math inline">\(\theta\)</span> and <span class="math inline">\(1-\theta\)</span>) raised to different powers we can use the Laws of Exponents and all we have to do is raise <span class="math inline">\(\theta\)</span> and <span class="math inline">\(1-\theta\)</span> to the sum of powers.</p>
<p>So <span class="math inline">\(\theta\)</span> gets raised to <span class="math inline">\(a+s-1\)</span> and <span class="math inline">\(1-\theta\)</span> gets raised to <span class="math inline">\(b+n-s-1\)</span>.</p>
<p>See <a href="https://www.mathsisfun.com/algebra/exponent-laws.html">here</a> for a refresher on the Laws of Exponents.</p>
<p>We end up with a posterior distribution:</p>
<p><span class="math display">\[\theta^{(a+s-1)}(1-\theta^{(b+n-s-1)})\]</span></p>
<p>The important point to note here is that our posterior distribution is:</p>
<p><span class="math display">\[
Beta(a, b)
\]</span> where <span class="math inline">\(a = a+s\)</span> and <span class="math inline">\(b = b+n-s\)</span>.</p>
<p>This makes it easy to calculate - we just add some numbers together! So cool!</p>
</section>
<section id="shape-of-the-beta-distribution" class="level3">
<h3 class="anchored" data-anchor-id="shape-of-the-beta-distribution">Shape of the beta distribution</h3>
<p>In the Beta distribution <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> should both be positive and together they describe the shape of a particular Beta distribution. The first parameter, <span class="math inline">\(a\)</span> can be thought of as the mode of the distribution i.e.&nbsp;where most of our probability will pile up. In this sense <span class="math inline">\(a\)</span> can be considered the ‘number of successes’ we think there should be. If we think there should be a lot of successes then the beta distribution will pile more probability closer to 1.</p>
<p>Here are several Beta distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) <span class="co"># plotting in grid; 2 rows, 3 cols</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>) <span class="co"># possible probs</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="dv">1</span>; b<span class="ot">=</span><span class="dv">5</span> <span class="co"># Beta(a,b) params</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>)){</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    a_mod <span class="ot">=</span> a<span class="sc">+</span>i<span class="sc">+</span><span class="dv">5</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    y<span class="ot">=</span><span class="fu">dbeta</span>(x, a_mod, b) <span class="co"># density of Beta distribution</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the curves</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(x, y, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">'Prob'</span>, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste</span>(<span class="fu">paste</span>(<span class="st">'a='</span>,a_mod), <span class="fu">paste</span>(<span class="st">'b='</span>,b), <span class="at">sep =</span> <span class="st">'; '</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Several Beta distributions-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Beta distributions</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As <span class="math inline">\(a\)</span> increases the mode of the distribution moves right indicating more belief in an increased probability of success (<span class="math inline">\(\theta\)</span> on the x-axis). Conversely if <span class="math inline">\(a\)</span> gets smaller then the mode moves left.</p>
<p>The sum, <span class="math inline">\(a+b\)</span> controls the spread of the distribution and can be thought of as the ‘amount of evidence’, the plausibility, or my ‘belief’ in a particular probability of success. As <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> get bigger the sum <span class="math inline">\(a+b\)</span> gets bigger and the distribution gets narrower piling more probability over some value of <span class="math inline">\(\theta\)</span>.</p>
<p>If <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are the same number and &gt; 1 then the distribution is symmetrical around 0.5. One special case is if <span class="math inline">\(a = b = 1\)</span>. In this case we have a uniform distribution over the whole probability range - a straight horizontal line.</p>
<p>Here are some more Beta distributions to illustrate some of those points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)) <span class="co"># plotting in grid</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>) <span class="co"># probs</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="dv">1</span>; b<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">6</span>)){</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    y<span class="ot">=</span><span class="fu">dbeta</span>(x, a<span class="sc">+</span>i, b<span class="sc">+</span>i) <span class="co"># Beta(a,b) density</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#the plots</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(x, y, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(y<span class="fl">+0.05</span>)), <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">'prob'</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste</span>(<span class="fu">paste</span>(<span class="st">'a='</span>,a<span class="sc">+</span>i), <span class="fu">paste</span>(<span class="st">'b='</span>, b<span class="sc">+</span>i), <span class="at">sep =</span> <span class="st">'; '</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Some more beta distributions-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">More Beta distributions</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As we add more ‘evidence’ (<span class="math inline">\(a+b\)</span>) the Beta distribution gets narrower.</p>
</section>
<section id="setting-a-prior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="setting-a-prior-distribution">Setting a prior distribution</h3>
<p>Getting back to our question of the proportion of students who get first class marks we’ll begin with flat prior i.e.&nbsp;we initially believe that <em>any</em> proportion from 0 to 100% is realistic. We can represent this belief in any proportion as a Beta distribution with <span class="math inline">\(a\)</span> = 1 and <span class="math inline">\(b\)</span> = 1.</p>
<p>The first year available to us is 2010 and we’ll use this data to calculate a posterior distribution for the proportion of students who get a first class mark.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>data_in <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/c5_firsts.csv'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>ten <span class="ot">&lt;-</span> data_in <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2010</span>) <span class="co"># 2010 data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>succ <span class="ot">&lt;-</span> ten <span class="sc">%&gt;%</span> <span class="fu">tally</span>(first) <span class="sc">%&gt;%</span> <span class="fu">pull</span>() <span class="co"># all successes</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(ten) <span class="co"># all trials</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve read in the data, subset it down to just the 2010 data and calculated both the number of successes and the total number of trials.</p>
<p>Let’s set up and plot our prior Beta distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot prior</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># possible proportions (theta)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># density of x under Beta(1,1) dist</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a, b) <span class="co"># prior</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(theta), <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Uniform Beta distribution-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">A Uniform prior distribution (Beta(1,1))</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As you can see this is a uniform distribution - the probability is exactly the same for every proportion (<span class="math inline">\(\theta\)</span>) on the x-axis.</p>
<p>Now let’s calculate our posterior distribution. We just have to add the number of successes to the <span class="math inline">\(a\)</span> parameter of our Beta prior; then calculate n minus successes and add that to the <span class="math inline">\(b\)</span> parameter of our Beta prior. We’ll then plot our prior and our posterior together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate posterior</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>new_y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a <span class="sc">+</span> succ, b <span class="sc">+</span> n <span class="sc">-</span> succ) <span class="co"># posterior - so easy!</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, new_y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)), <span class="at">col=</span><span class="st">'darkorange3'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># prior</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># labels</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="fl">0.6</span>, <span class="at">y=</span><span class="fu">max</span>(new_y)<span class="sc">-</span><span class="dv">4</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">'prior'</span>, <span class="st">'posterior'</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">'black'</span>, <span class="st">'darkorange3'</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">bty=</span><span class="st">'n'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Plot prior &amp; posterior-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Prior &amp; posterior</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Sweet! We’ve updated our view of the world based on some data. Where we thought every proportion was equally plausible before data actually suggests support for about 1-20%. And all we had to do was add some numbers together!</p>
<p>The posterior distribution is a Beta distribution. Let’s see what the parameters of that distribution are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Beta posterior parameters</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>a_post <span class="ot">&lt;-</span> a <span class="sc">+</span> succ</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>b_post <span class="ot">&lt;-</span> b <span class="sc">+</span> n <span class="sc">-</span> succ</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>a_post</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>b_post</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 58</code></pre>
</div>
</div>
<p>So <span class="math inline">\(a\)</span> is 5 and <span class="math inline">\(b\)</span> is 58 and the posterior is <span class="math inline">\(Beta(5,58)\)</span>.</p>
<p>Let’s see what the most probable proportion is. This is the mode of the posterior. The mode of a Beta distribution calculated as:</p>
<p><span class="math display">\[\frac{a-1}{a+b-2}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior mode</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>post_mode <span class="ot">&lt;-</span> (a_post <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">/</span>(a_post <span class="sc">+</span> b_post <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>post_mode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06557377</code></pre>
</div>
</div>
<p>The best supported proportion (<span class="math inline">\(\theta\)</span>) of first class students is about 6.6%.</p>
<p>What about a 95% probability interval for the true proportion? Well we can get that using the <code>qbeta()</code> function. We have to enter the probability interval we want and then the <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> parameters of the distribution.</p>
<p>If we want a 95% interval we need to have an interval such that 5% of the distribution is excluded and this means 2.5% from each end. So we need to enter 0.025 and 0.975 as the probabilities we want in <code>qbeta()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># highest density interval</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>hdi <span class="ot">&lt;-</span> <span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), a_post, b_post)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>hdi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02670462 0.15702808</code></pre>
</div>
</div>
<p>This analysis would suggest there’s a 95% probability that the interval from about 3% to about 16% contains the true proportion of first class marks based on our data and our prior assumption of a uniform distribution over <span class="math inline">\(\theta\)</span>. This interval is called the <strong>Highest Density Interval (HDI)</strong> or <strong>Credible Interval (CI)</strong> and (unlike a 95% confidence interval) is directly interpretable as a probability of where <span class="math inline">\(\theta\)</span> lies.</p>
<p>Let’s plot this interval.</p>
<p>The strategy for this is to plot the posterior distribution and then use the <code>polygon()</code> function to shade the posterior within the limits we define.</p>
<p>We first make a vector of x-values that go from the first quantile we want (0.027), along a sequence (<code>seq(start, stop, gap))</code> to the last quantile we want (0.157).</p>
<p>We then make a vector of y-values to match this going from zero, up the density curve of our distribution (<code>dbeta(seq(start, stop, gap), a, b)</code>) and then back to zero. We plot this shape and colour fill it using the <code>polygon()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data for plot</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>new_y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_post, b_post) <span class="co"># posterior - so easy!</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, new_y, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(theta), <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main  =</span> <span class="st">'95% HDI for Proportion'</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'darkorange3'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># define HDI</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>x_coords <span class="ot">&lt;-</span> <span class="fu">c</span>(hdi[<span class="dv">1</span>], <span class="fu">seq</span>(hdi[<span class="dv">1</span>], hdi[<span class="dv">2</span>], <span class="fl">0.001</span>), hdi[<span class="dv">2</span>])</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>y_coords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">dbeta</span>(<span class="fu">seq</span>(hdi[<span class="dv">1</span>], hdi[<span class="dv">2</span>], <span class="fl">0.001</span>), a_post, b_post), <span class="dv">0</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot HDI</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(x_coords, y_coords, <span class="at">col=</span><span class="st">'skyblue'</span>, <span class="at">border =</span> <span class="st">'darkorange3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Plot HDI-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Posterior with 95% HDI</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The blue part is where we believe the true proportion, <span class="math inline">\(\theta\)</span> of first class marks lies with 95% probability.</p>
</section>
<section id="an-informed-prior" class="level3">
<h3 class="anchored" data-anchor-id="an-informed-prior">An informed prior</h3>
<p>We’ll now examine the student data using a more informed prior. In the <a href="https://iaingallagher.github.io/posts/bayes_two_grid_approx/Bayes_part_2_grid_estimation.html">previous post</a> my initial belief was that around 10% of students would achieve a first class mark and this is somewhat supported by the analysis above. To reflect my belief in 10% I’ll create a semi-informative Beta prior around 10%.</p>
<p>What should the parameters (<span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>) of this Beta distribution be? One way to approach this is to consider that the <strong>mean</strong> proportion of successes will be <span class="math inline">\(m = a/(a+b)\)</span> and the sample size (<span class="math inline">\(n\)</span>) will be <span class="math inline">\(n = a+b\)</span>. From this we can see that <span class="math inline">\(a = m \times n\)</span> and <span class="math inline">\(b = (1-m)n\)</span>.</p>
<p>The value of <span class="math inline">\(m\)</span> is our guess for the mean value of <span class="math inline">\(\theta\)</span> before we see data or based on our domain expertise - here that’s 0.1 (i.e.&nbsp;10%). The value of <span class="math inline">\(n\)</span> can be thought of as the amount of data we have previously seen which informs our prior guesstimate for <span class="math inline">\(\theta\)</span>. In this case although we’re guessing we’d feel somewhat happy basing our belief on 20 previous sets of trials.</p>
<p>Now we have values for <span class="math inline">\(m\)</span> (0.1) and <span class="math inline">\(n\)</span> (20) we can calculate <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>.</p>
<p><span class="math inline">\(a = m\times n = 0.1\times 20 = 2\)</span></p>
<p><span class="math inline">\(b = (1-m)\times n = (1-0.1)\times 20 = 18\)</span></p>
<p>Our prior distribution over <span class="math inline">\(\theta\)</span> is <span class="math inline">\(Beta(2, 18)\)</span> &amp; looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># params</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, <span class="dv">2</span>, <span class="dv">18</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)), <span class="at">main =</span> <span class="st">'Informed Prior'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Informed prior-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">An informed prior</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>You can see this is most strongly peaked over 10%. Now we’ll simply repeat the analysis we did above with our new, informed beta prior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set prior</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">18</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>new_y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a <span class="sc">+</span> succ, b <span class="sc">+</span> n <span class="sc">-</span> succ)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot posterior</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, new_y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)), <span class="at">col=</span><span class="st">'darkorange3'</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot prior</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="fl">0.6</span>, <span class="at">y=</span><span class="fu">max</span>(new_y)<span class="sc">-</span><span class="dv">4</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">'prior'</span>, <span class="st">'posterior'</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">'black'</span>, <span class="st">'darkorange3'</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">bty=</span><span class="st">'n'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Informed prior analysis-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Informed prior and posterior</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The more informed prior has led to a posterior distribution that is more tightly peaked over 10%. The mode and 95% HDI for this new posterior distribution are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior params</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>a_post <span class="ot">&lt;-</span> a <span class="sc">+</span> succ</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>b_post <span class="ot">&lt;-</span> b <span class="sc">+</span> n <span class="sc">-</span> succ</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior mode</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>post_mode <span class="ot">&lt;-</span> (a_post<span class="dv">-1</span>)<span class="sc">/</span>(a_post <span class="sc">+</span> b_post<span class="dv">-2</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>post_mode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06329114</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hdi</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>hdi <span class="ot">&lt;-</span> <span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), a_post, b_post)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>hdi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02802055 0.13985708</code></pre>
</div>
</div>
<p>The posterior with the 95% HDI looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior &amp; hdi</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>new_y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a_post, b_post) <span class="co"># posterior - so easy!</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, new_y, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">expression</span>(theta), <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main  =</span> <span class="st">'95% HDI for Proportion'</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'darkorange3'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define HDI</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>x_coords <span class="ot">&lt;-</span> <span class="fu">c</span>(hdi[<span class="dv">1</span>], <span class="fu">seq</span>(hdi[<span class="dv">1</span>], hdi[<span class="dv">2</span>], <span class="fl">0.001</span>), hdi[<span class="dv">2</span>])</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>y_coords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">dbeta</span>(<span class="fu">seq</span>(hdi[<span class="dv">1</span>], hdi[<span class="dv">2</span>], <span class="fl">0.001</span>), a_post, b_post), <span class="dv">0</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot HDI</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(x_coords, y_coords, <span class="at">col=</span><span class="st">'skyblue'</span>, <span class="at">border =</span> <span class="st">'darkorange3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/New posterior with HDI-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Informed prior and posterior with HDI</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="posteriors-as-priors" class="level3">
<h3 class="anchored" data-anchor-id="posteriors-as-priors">Posteriors as priors</h3>
<p>One of the best features of Bayesian analysis is that it’s easy to update your knowledge as you sequentially collect more data. We can often just treat the posterior from a previous analysis as the prior for a new analysis. This kind of sequential analysis is harder in the frequentist world.</p>
<p>We have data here from 2010 until 2015. Imagine we analysed this data as we went along from year to year. We might start in 2010 with the informative prior around 10% as we did in the analysis above. To examine the 2011 data we could use the posterior distribution from 2010 as the prior distribution for 2011 and so on.</p>
<p>We do that in the code below and generate a grid of plots showing how the posterior distribution evolves over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) <span class="co"># grid for plots</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get the data</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>data_in <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/c5_firsts.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 402 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): module
dbl (2): year, first

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the unique years</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(data_in<span class="sc">$</span>year)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set chosen prior</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">18</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for loop</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years)){</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset the data</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  yr_data <span class="ot">&lt;-</span> data_in <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> years[i])</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate successes and total trials</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  succ <span class="ot">&lt;-</span> <span class="fu">sum</span>(yr_data<span class="sc">$</span>first)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(yr_data)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set values for initial prior plot</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="fl">0.001</span>) </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(x, a, b)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate a &amp; b for Beta posterior</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> a <span class="sc">+</span> succ</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> b <span class="sc">+</span> n <span class="sc">-</span> succ</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the posterior &amp; mode</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  new_y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>( x, a, b) </span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  md <span class="ot">&lt;-</span> (a<span class="dv">-1</span>)<span class="sc">/</span>(a<span class="sc">+</span>b<span class="dv">-2</span>) </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make plots</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, new_y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)),</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>years[i], <span class="at">col=</span><span class="st">'darkorange3'</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">'Posterior Mode: '</span>, <span class="fu">round</span>(md,<span class="dv">2</span>), <span class="at">sep=</span><span class="st">''</span>), <span class="at">side=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="fl">0.9</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x,y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">'black'</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="at">x=</span><span class="fl">0.5</span>, <span class="at">y=</span><span class="fu">max</span>(new_y)<span class="sc">-</span><span class="dv">1</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">'prior'</span>, <span class="st">'posterior'</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">'black'</span>, <span class="st">'darkorange3'</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">bty=</span><span class="st">'n'</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Sequential analysis-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Updating posteriors</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>There are a few things to note here. Firstly we can see that as we collect more data over the years the proportion of first class marks does indeed approach 10% 😁 Secondly it’s also apparent that as we collect data over the years the posterior becomes progressively narrower; we become more &amp; more confident about the actual proportion. However even by 2015 with a total of 400 datapoints collected over the years there is still some width to the posterior. We’re close to 10% but not entirely sure!</p>
</section>
</section>
<section id="impact-of-a-poor-prior" class="level2">
<h2 class="anchored" data-anchor-id="impact-of-a-poor-prior">Impact of a poor prior</h2>
<p>In Bayesian analysis the posterior distribution is a compromise between the prior and the likelihood. The prior can therefore have quite a strong effect on the posterior - especially if data is limited. In the analysis below we see the effect that an initial prior with a mode of 0.8 has on our parameter estimate. Given that my initial guess for the proportion of students getting a first class mark was ~10% this prior, which best supports 80% is not particularly sensible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)) <span class="co"># plot grid</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set poor prior; calculation as above but with a mean of 0.8 instead of 0.1</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for loop</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years)){</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset data</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  yr_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_in, data_in<span class="sc">$</span>year<span class="sc">==</span>years[i])</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># successes &amp; total trials</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  succ <span class="ot">&lt;-</span> <span class="fu">sum</span>(yr_data<span class="sc">$</span>first)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(yr_data)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set values for initial prior plot</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>( x, a, b)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate new a &amp; b for Beta posterior</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> a <span class="sc">+</span> succ</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> b <span class="sc">+</span> n <span class="sc">-</span> succ</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate posterior and mode</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  new_y <span class="ot">&lt;-</span> <span class="fu">dbeta</span>( x, a, b)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  md <span class="ot">&lt;-</span> (a<span class="dv">-1</span>)<span class="sc">/</span>(a<span class="sc">+</span>b<span class="dv">-2</span>)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plots</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, new_y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="fu">expression</span>(theta), <span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">'P('</span>, theta, <span class="st">')'</span>)),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span>years[i], <span class="at">col=</span><span class="st">'darkorange3'</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">'Posterior Mode: '</span>, <span class="fu">round</span>(md,<span class="dv">2</span>), <span class="at">sep=</span><span class="st">''</span>), <span class="at">side=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="fl">0.7</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x,y, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">'black'</span>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="at">x=</span><span class="fl">0.5</span>, <span class="at">y=</span><span class="fu">max</span>(new_y)<span class="sc">+</span><span class="fl">0.1</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">'prior'</span>, <span class="st">'posterior'</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">'black'</span>, <span class="st">'darkorange3'</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">bty=</span><span class="st">'n'</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Non-informative prior-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Data will overwhelm an uninformative prior</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Although the estimate of <span class="math inline">\(\theta\)</span> starts off at 80% (prior in the top left plot) we can see that the data pulls the posterior distribution over to the lower end of the possible proportions. Once we have analysed all our data the prior and posterior are approaching the same estimate as before. This demonstrates that enough data will overwhelm a poor choice of prior. However you may not always have a lot of data! The width of the prior also makes a difference. If we are very confident about a value then we might have a very narrow prior over that value. It then takes more data to shift that prior to other values.</p>
</section>
<section id="other-conjugate-priors" class="level2">
<h2 class="anchored" data-anchor-id="other-conjugate-priors">Other conjugate priors</h2>
<p>In this post we have concentrated on the Beta-Binomial to illustrate the idea and use of conjugate priors. However there are other conjugate combinations. The illustration below from <a href="https://www.johndcook.com/blog/conjugate_prior_diagram/">John Cook</a> shows some of these.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pics/conjugate_prior_diagram.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption class="figure-caption">Common Conjugate Distributions</figcaption><p></p>
</figure>
</div>
<p>A much fuller account of conjugate priors is given in Chapter 5 of the excellent <a href="https://www.bayesrulesbook.com/chapter-5.html">Bayes Rules</a> online book. The <code>bayesrules</code> package which accompanies the book has useful functionality for conjugate prior analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesrules)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot prior, posterior &amp; likelihood</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_beta_binomial</span>(<span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">beta =</span> <span class="dv">18</span>, <span class="at">y =</span> <span class="fu">sum</span>(ten<span class="sc">$</span>first), <span class="at">n =</span> <span class="fu">nrow</span>(ten)) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BayesIntro2_Conjugate-Priors_files/figure-html/Using `bayesrules`-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise posterior</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_beta_binomial</span>(<span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">beta =</span> <span class="dv">18</span>, <span class="at">y =</span> <span class="fu">sum</span>(ten<span class="sc">$</span>first), <span class="at">n =</span> <span class="fu">nrow</span>(ten))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      model alpha beta       mean       mode          var         sd
1     prior     2   18 0.10000000 0.05555556 0.0042857143 0.06546537
2 posterior     6   75 0.07407407 0.06329114 0.0008364281 0.02892107</code></pre>
</div>
</div>
<p>The summary value for the posterior mode using the 2010 data are the same as we got above with our informed prior.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this post we have looked at conjugate priors. In the context of Bayesian inference conjugacy means that the posterior distribution is in the same mathematical family as the prior distribution. Conjugate priors make Bayesian inference computationally tractable because we can go from prior to posterior with simple arithmetic. However there are not many conjugate distributions and realistic data analysis often cannot be addressed with a conjugate analysis. Usually we have to use more computationally intensive methods like Monte Carlo Markov Chain (MCMC) to define the posterior distribution. We’ll examine MCMC approaches to Bayesian inference in the next post.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>