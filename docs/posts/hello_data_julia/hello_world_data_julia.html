<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-09-23">

<title>iaingallagher.github.io - Hello Data World 3 (julia)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">iaingallagher.github.io</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Hello Data World 3 (julia)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">julia</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 23, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This is the third of three posts that will carry out data loading, exploration, filtering and statistical testing using different ‘data science’ programming languages. In the <a href="https://iaingallagher.github.io/posts/hello_data_r/hello_world_data_R.html">first post</a> of the series we used <a href="https://www.r-project.org">R</a>; in the <a href="https://iaingallagher.github.io/posts/hello_data_python/hello_world_data_python.html">second post</a> we used <a href="https://www.python.org/">python</a>. In this post we’ll use <a href="https://julialang.org/">julia</a>. I’ll add some extra commentary in this post about using julia because it’s new and not so familiar (to me anyway). If you want to follow along then the data are <a href="https://github.com/iaingallagher/iaingallagher.github.io/tree/main/data">here</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
‘Time to first plot’ problem
</div>
</div>
<div class="callout-body-container callout-body">
<p>Julia has been designed to be fast as well as having a bunch of other advantages from modern computer science. The speed comes from the use of software called <a href="https://llvm.org/">LLVM</a> for just-in-time compilation. The developers hope it helps solve the ‘two-language problem’ where machine learning applications/data science are written in a slow high-level language like R or python and then translated to a fast lower-level language like C++ or Rust for actual use. You can read more about this <a href="https://julialang.org/blog/2012/02/why-we-created-julia/">here</a>.</p>
<p>However one consequence of just-in-time compilation is increased latency the first time any function is called because new machine code has to be compiled. In the julia community this is described as the ‘time to first plot problem’ because it can take a while to generate a plot the first time you call a plotting function (as we’ll see later). The time-to-first plot problem makes <code>julia</code> like the F1 car in <a href="https://www.youtube.com/watch?v=3RuUp5MT3Uc">this video</a> (start at ~5.30 if you don’t want the whole thing). It starts later but once it gets going it flies along. The julia version used to write this post was version 1.8.5. Latency improvments are <a href="https://twitter.com/vchuravy/status/1607866217259479041">expected</a> in julia 1.9.</p>
<p>If all this is gobbledygook then the TLDR is that the first time you do anything in julia in a fresh session it can take a while (especially plotting). Once it’s going though it goes very fast.</p>
</div>
</div>
<section id="preliminaries" class="level3">
<h3 class="anchored" data-anchor-id="preliminaries">Preliminaries</h3>
<p>Like R and python, julia has a host of extra packages to help with data import, wrangling, plotting &amp; building various kinds of models. Julia is a young language in the data science/ numerical computing space. The version 1.0 release was only in 2018. This means that the infrastructure for analysis, data wrangling, plotting etc is not quite as stable as either R or python (although the version 1.0 release helped a lot with this). Julia packages may come and go and may or may not be maintained over the coming years. Everything I’ve used here (written in 2022) has a good level of support though and these packages should still be in existence in years to come although the exact syntax for usage might change. You can read about how to install julia packages <a href="https://docs.julialang.org/en/v1/stdlib/Pkg/">here</a>.</p>
<p>In any case the first step is to load the packages we will need. This will also take a while because some code is compiled at load time!</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading &amp; wrangling data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span>, <span class="bu">DataFrames </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting; algebraofgraphics is built on the Makie plotting package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span>, <span class="bu">AlgebraOfGraphics</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>CairoMakie.<span class="fu">activate!</span>(<span class="kw">type</span> <span class="op">=</span> <span class="st">"svg"</span>) <span class="co"># high quality plots; note use of !</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># frequentist stats</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">HypothesisTests </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># bayesian stats</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span>, <span class="bu">TuringGLM</span>, <span class="bu">ArviZ </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-data">Loading the data</h3>
<p>The <code>read()</code> function from the <a href="https://csv.juliadata.org/stable/"><code>CSV</code></a> package reads in the csv formatted data. The last argument to the function (<code>DataFrame</code>) provides a ‘sink’ for the loaded data i.e.&nbsp;turns the loaded data into a <a href="https://dataframes.juliadata.org/stable/"><code>DataFrame</code></a> object.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get data; note defintion of missing values in function call</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"data/BODY_COMPOSITION_DATA.csv"</span>, header <span class="op">=</span> <span class="fl">1</span>, missingstring <span class="op">=</span> <span class="st">"NA"</span>, DataFrame)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(df, <span class="fl">5</span>) <span class="co"># first 5 rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><div style="float: left;"><span>5×10 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">girths</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">bia</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DW</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">jackson</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">HW</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">skinfolds</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">BMI</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">WHR</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Waist</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String1">String1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Float64}">Float64?</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Float64}">Float64?</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">10.85</td>
<td style="text-align: right;">5.7</td>
<td style="text-align: right;">9.22</td>
<td style="text-align: right;">4.75</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">50.75</td>
<td style="text-align: right;">20.7</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">76.5</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">14.12</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">11.8</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">16.9</td>
<td style="text-align: right;">46.3</td>
<td style="text-align: right;">21.9</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">75.0</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">12.3</td>
<td style="text-align: right;">6.3</td>
<td style="text-align: right;">12.0</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">14.8</td>
<td style="text-align: right;">45.8</td>
<td style="text-align: right;">21.39</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">70.0</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">8.5</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">10.85</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">10.2</td>
<td style="text-align: right;">43.55</td>
<td style="text-align: right;">19.26</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">68.5</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">11.66</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">15.6</td>
<td style="text-align: right;">12.0</td>
<td style="text-align: right;">11.86</td>
<td style="text-align: right;">93.5</td>
<td style="text-align: right;">22.3</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">74.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="exploration-tidying" class="level3">
<h3 class="anchored" data-anchor-id="exploration-tidying">Exploration &amp; tidying</h3>
<p>The <code>DataFrames</code> package provides tools for exploring the data.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summarise data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><div style="float: left;"><span>10×7 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">min</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">median</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">max</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">nmissing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eltype</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Symbol">Symbol</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Nothing, Float64}">Union…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Any">Any</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Nothing, Float64}">Union…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Any">Any</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Type">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">sex</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">F</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">String1</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">girths</td>
<td style="text-align: left;">20.705</td>
<td style="text-align: left;">7.15</td>
<td style="text-align: left;">20.12</td>
<td style="text-align: left;">87.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">bia</td>
<td style="text-align: left;">16.9797</td>
<td style="text-align: left;">5.7</td>
<td style="text-align: left;">16.2</td>
<td style="text-align: left;">39.3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Union{Missing, Float64}</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">DW</td>
<td style="text-align: left;">21.6638</td>
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">21.4</td>
<td style="text-align: left;">45.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">jackson</td>
<td style="text-align: left;">14.2333</td>
<td style="text-align: left;">3.0</td>
<td style="text-align: left;">12.8</td>
<td style="text-align: left;">35.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">6</td>
<td style="text-align: left;">HW</td>
<td style="text-align: left;">21.4243</td>
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">21.0</td>
<td style="text-align: left;">43.0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Union{Missing, Float64}</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">7</td>
<td style="text-align: left;">skinfolds</td>
<td style="text-align: left;">82.881</td>
<td style="text-align: left;">27.75</td>
<td style="text-align: left;">76.23</td>
<td style="text-align: left;">181.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">8</td>
<td style="text-align: left;">BMI</td>
<td style="text-align: left;">23.2509</td>
<td style="text-align: left;">2.9</td>
<td style="text-align: left;">23.0</td>
<td style="text-align: left;">33.03</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">9</td>
<td style="text-align: left;">WHR</td>
<td style="text-align: left;">0.782105</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.78</td>
<td style="text-align: left;">0.99</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">10</td>
<td style="text-align: left;">Waist</td>
<td style="text-align: left;">76.8379</td>
<td style="text-align: left;">61.0</td>
<td style="text-align: left;">76.0</td>
<td style="text-align: left;">100.8</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can see from the <code>nmissing</code> column that there are missing data in the HW and bia columns. The last column of this output (<code>eltype</code>) tells us the type of data we have &amp; where we see <code>Union{Missing, Float64}</code> the column of data contains both <code>Float64</code> and <code>Missing</code> data.</p>
<p>We can drop the rows containing missing values with the <code>dropmissing()</code> function. The <code>dropmissing!()</code> variant (i.e.&nbsp;with <code>!</code>) means we change the data ‘in place’; the actual data we loaded is changed. The use of <code>!</code> like this is a common motif in julia to make in-place changes to objects (data, plots, variables etc).</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ! means in-place change</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>DataFrames.<span class="fu">dropmissing!</span>(df)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div><div style="float: left;"><span>10×7 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">min</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">median</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">max</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">nmissing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eltype</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Symbol">Symbol</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Nothing, Float64}">Union…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Any">Any</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Nothing, Float64}">Union…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Any">Any</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="DataType">DataType</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">sex</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">F</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">String1</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">girths</td>
<td style="text-align: left;">20.7346</td>
<td style="text-align: left;">7.15</td>
<td style="text-align: left;">20.12</td>
<td style="text-align: left;">87.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">bia</td>
<td style="text-align: left;">16.9801</td>
<td style="text-align: left;">5.7</td>
<td style="text-align: left;">15.9</td>
<td style="text-align: left;">39.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">DW</td>
<td style="text-align: left;">21.6146</td>
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">21.4</td>
<td style="text-align: left;">45.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">jackson</td>
<td style="text-align: left;">14.2122</td>
<td style="text-align: left;">3.0</td>
<td style="text-align: left;">12.6</td>
<td style="text-align: left;">35.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">6</td>
<td style="text-align: left;">HW</td>
<td style="text-align: left;">21.4264</td>
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">21.0</td>
<td style="text-align: left;">43.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">7</td>
<td style="text-align: left;">skinfolds</td>
<td style="text-align: left;">82.6848</td>
<td style="text-align: left;">27.75</td>
<td style="text-align: left;">76.23</td>
<td style="text-align: left;">181.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">8</td>
<td style="text-align: left;">BMI</td>
<td style="text-align: left;">23.223</td>
<td style="text-align: left;">2.9</td>
<td style="text-align: left;">23.0</td>
<td style="text-align: left;">33.03</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">9</td>
<td style="text-align: left;">WHR</td>
<td style="text-align: left;">0.781529</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.78</td>
<td style="text-align: left;">0.99</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">10</td>
<td style="text-align: left;">Waist</td>
<td style="text-align: left;">76.7567</td>
<td style="text-align: left;">61.0</td>
<td style="text-align: left;">76.0</td>
<td style="text-align: left;">100.8</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The missing value rows have been removed from the data. Next we will convert our data from wide format to long format <span class="citation" data-cites="wickham2014">(<a href="#ref-wickham2014" role="doc-biblioref">Wickham 2014</a>)</span> using the <code>stack()</code> function. In long format the values for each individual and each measurement technique are identified by rows rather than spread across row &amp; column combinations. The long data format will make later plotting and statistical analyses easier.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reshape data to long</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dfl <span class="op">=</span> DataFrames.<span class="fu">stack</span>(df, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrames.stack() here because TuringGLM also has a stack function; we need to be explicit about the version of stack() we want to use</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(dfl, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><div style="float: left;"><span>5×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">value</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String1">String1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">girths</td>
<td style="text-align: right;">10.85</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">girths</td>
<td style="text-align: right;">14.12</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">girths</td>
<td style="text-align: right;">12.3</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">girths</td>
<td style="text-align: right;">8.5</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">girths</td>
<td style="text-align: right;">11.66</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(dfl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div><div style="float: left;"><span>3×7 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">min</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">median</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">max</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">nmissing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eltype</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Symbol">Symbol</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Nothing, Float64}">Union…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Any">Any</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Nothing, Float64}">Union…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Any">Any</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="DataType">DataType</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">sex</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">F</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">String1</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">variable</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">BMI</td>
<td style="text-align: left; font-style: italic;"></td>
<td style="text-align: left;">skinfolds</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">String</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">30.9349</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">21.6</td>
<td style="text-align: left;">181.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Float64</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As well as data summaries, exploration with plots is an essential step for checking values and the distribution of data. There are quite a few <a href="https://juliapackages.com/c/graphical-plotting">plotting packages for julia</a> with various general or more specific uses. In this post we’ll use the <a href="https://makie.juliaplots.org/stable/"><code>Makie</code></a> <span class="citation" data-cites="danischMakieJlFlexible2021">(<a href="#ref-danischMakieJlFlexible2021" role="doc-biblioref">Danisch and Krumbiegel 2021</a>)</span> package which seems to have good mindshare in the julia community, is being actively developed and can cover many different graphical presentation styles. To use <code>Makie</code> for faceted plots we can call on the <a href="http://juliaplots.org/AlgebraOfGraphics.jl/stable/"><code>AlgebraOfGraphics</code></a> package which is built on <code>Makie</code>. If you’ve used <code>ggplot2</code> in R then <code>AlgebraOfGraphics</code> aims to provide very similar functionality. I tried several other packages (<code>Gadfly</code>, <code>StatsPlots</code>, <code>VegaLite</code>) here as well but I couldn’t get any of them to produce a plot I liked. It seems as though production of facet/trellis plots with jittered data points is an area for development in julia!</p>
<p>Unfortunately <code>AlgebraOfGraphics</code> doesn’t support jittering points (or a beeswarm plot) yet (I think jittering is useful in a plot like this so all the data can be seen) so in the code below we create boxplots rather than jittered points.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># faceted boxplot of all variables coloured by Sex</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bxpl <span class="op">=</span> <span class="fu">data</span>(dfl) <span class="op">*</span> <span class="fu">visual</span>(BoxPlot) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>sex, <span class="op">:</span>value, color <span class="op">=:</span>sex, layout <span class="op">=</span> <span class="op">:</span>variable) <span class="co"># faceting is defined by layout argument</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># http://juliaplots.org/AlgebraOfGraphics.jl/dev/gallery/gallery/layout/faceting/</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">"F"</span> <span class="op">=&gt;</span> <span class="op">:</span>firebrick, <span class="st">"M"</span> <span class="op">=&gt;</span> <span class="op">:</span>cornflowerblue]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># draw() to show plot</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(bxpl, facet <span class="op">=</span> (;linkyaxes <span class="op">=</span> <span class="op">:</span>none), palettes <span class="op">=</span> (color <span class="op">=</span> cols,), figure<span class="op">=</span>(;resolution<span class="op">=</span>(<span class="fl">800</span>,<span class="fl">800</span>))) <span class="co"># note trailing comma needed in palettes argument (defines a tuple)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<p><img src="hello_world_data_julia_files/figure-html/cell-8-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>On my systems (i7 macbook pro (2015) &amp; i7 linux machine; both 16Gb RAM) this plot takes about 55s… time to first plot problem!</p>
</div>
</div>
<p>There are a couple of mad values in the <code>BMI</code> and <code>girths</code> variables. For the rest of the analysis we’ll concentrate on the <code>BMI</code> variable. First we’ll filter the data to just BMI and then plot that data.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter using anonymous function x -&gt; x == "BMI"; x where x = BMI</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://juliadatascience.io/filter_subset</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>bmi <span class="op">=</span> <span class="fu">subset</span>(dfl, <span class="op">:</span>variable <span class="op">=&gt;</span> <span class="fu">ByRow</span>(x <span class="op">-&gt;</span> x <span class="op">==</span> <span class="st">"BMI"</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot just BMI</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>bmipl <span class="op">=</span> <span class="fu">data</span>(bmi) <span class="op">*</span> <span class="fu">visual</span>(BoxPlot) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>sex, <span class="op">:</span>value, color <span class="op">=</span> <span class="op">:</span>sex)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(bmipl, palettes <span class="op">=</span> (color <span class="op">=</span> cols,), figure <span class="op">=</span> (; resolution <span class="op">=</span> (<span class="fl">400</span>,<span class="fl">400</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<p><img src="hello_world_data_julia_files/figure-html/cell-9-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>The unrealistically low value in the male BMI is obvious.</p>
<p>We’ll filter the BMI variable to sensible values for sample (i.e.&nbsp;students) by only including values here BMI is &gt; 18.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bmi <span class="op">=</span> <span class="fu">filter</span>(<span class="op">:</span>value <span class="op">=&gt;</span> x <span class="op">-&gt;</span> x <span class="op">&gt;</span> <span class="fl">18</span>, bmi)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># redo plot to check</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>bmipl <span class="op">=</span> <span class="fu">data</span>(bmi) <span class="op">*</span> <span class="fu">visual</span>(BoxPlot) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>sex, <span class="op">:</span>value, color <span class="op">=</span> <span class="op">:</span>sex)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(bmipl, palettes <span class="op">=</span> (color <span class="op">=</span> cols,), figure <span class="op">=</span> (; resolution <span class="op">=</span> (<span class="fl">400</span>,<span class="fl">400</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<p><img src="hello_world_data_julia_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>The data look much better.</p>
</section>
<section id="frequentist-testing" class="level3">
<h3 class="anchored" data-anchor-id="frequentist-testing">Frequentist testing</h3>
<p>We’re now in a position to undertake some statistical analysis. We’ll start with a simple t-test to examine the mean difference in BMI between males and females. The <a href="https://juliastats.org/HypothesisTests.jl/stable/"><code>HypothesisTesting.jl</code></a> package provides functions for frequentist testing including t-tests. We first extract the data we want to test into separate series and then pass these series to the appropriate function. Here we are using the unequal variance t-test (i.e.&nbsp;Welch’s test).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data vectors</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mdata <span class="op">=</span> <span class="fu">filter</span>(<span class="op">:</span>sex <span class="op">=&gt;</span> x <span class="op">-&gt;</span> x <span class="op">==</span> <span class="st">"M"</span>, bmi).value</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fdata  <span class="op">=</span> <span class="fu">filter</span>(<span class="op">:</span>sex <span class="op">=&gt;</span> x <span class="op">-&gt;</span> x <span class="op">==</span> <span class="st">"F"</span>, bmi).value</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># carry out test</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">UnequalVarianceTTest</span>(mdata, fdata)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Two sample t-test (unequal variance)
------------------------------------
Population details:
    parameter of interest:   Mean difference
    value under h_0:         0
    point estimate:          0.824192
    95% confidence interval: (0.055, 1.593)

Test summary:
    outcome with 95% confidence: reject h_0
    two-sided p-value:           0.0359

Details:
    number of observations:   [118,82]
    t-statistic:              2.113420475300814
    degrees of freedom:       192.04757366286913
    empirical standard error: 0.38998033970175344</code></pre>
</div>
</div>
<p>There is quite a lot of detail here although this is not so different from the R <code>t.test()</code> output. The point estimate &amp; p-value are of most interest. We can get just the p-value using the <code>pvalue()</code> extractor function passing in the test and tail areas (i.e.&nbsp;one- or two-sided) we want. We can print a rounded p-value using string interpolation with <code>$(thing_we_want_to_print)</code>. There doesn’t seem to be a function to extract the point estimate though… that would be handy since p-values don’t contain point estimate information.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pv <span class="op">=</span> <span class="fu">pvalue</span>(<span class="fu">UnequalVarianceTTest</span>(mdata, fdata); tail <span class="op">=</span> <span class="op">:</span>both)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print p rounded to 3 dp</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"The p-value for the difference in male versus female BMI is </span><span class="sc">$</span>(<span class="fu">round</span>(pv, digits <span class="op">=</span> <span class="fl">3</span>))<span class="st">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The p-value for the difference in male versus female BMI is 0.036.</code></pre>
</div>
</div>
<p>There’s also a <code>confint()</code> function for confidence intervals.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> <span class="fu">confint</span>(<span class="fu">UnequalVarianceTTest</span>(mdata, fdata); tail <span class="op">=</span> <span class="op">:</span>both, level <span class="op">=</span> <span class="fl">0.95</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"The 95% CI for the difference in male versus female BMI is from </span><span class="sc">$</span>(<span class="fu">round</span>(ci[<span class="fl">1</span>], digits <span class="op">=</span> <span class="fl">3</span>))<span class="st"> to </span><span class="sc">$</span>(<span class="fu">round</span>(ci[<span class="fl">2</span>], digits <span class="op">=</span> <span class="fl">3</span>))<span class="st">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The 95% CI for the difference in male versus female BMI is from 0.055 to 1.593.</code></pre>
</div>
</div>
<p>The 95% CI here ranges from barely different (0.055 units larger) to quite different (1.59 units larger).</p>
</section>
<section id="bayesian-testing" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-testing">Bayesian testing</h3>
<p>LIke R and python julia has a package for the <code>Stan</code> probabilistic programming language called <a href="https://github.com/StanJulia/Stan.jl"><code>Stan.jl</code></a>. So one way to write Bayesian models in julia is to use <code>Stan.jl</code>. However we’ll use a native julia library called <a href="https://turing.ml/stable/"><code>Turing.jl</code></a> <span class="citation" data-cites="geTuringLanguageFlexible2018">(<a href="#ref-geTuringLanguageFlexible2018" role="doc-biblioref">Ge, Xu, and Ghahramani 2018</a>)</span>. <code>Turing.jl</code> allows us to write data generating models and then use Markov Chain Monte Carlo (MCMC) sampling with those model definitions to generate posterior distributions. <code>Turing.jl</code> supports a range of MCMC algorithms. In the code below we use the same priors we defined in the posts using R &amp; python.</p>
<p>First we create a dummy variable for sex such that males are coded as 1 and females are coded as 0 and we also extract the BMI values into a separate variable.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dummy vars for sex &amp; get value data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>indep_var <span class="op">=</span> <span class="fu">Int64</span>.(bmi.sex <span class="op">.==</span> <span class="st">"M"</span>); <span class="co"># vector of 1 &amp; 0's for M &amp; F respectively; the . after Int64 means 'broadcast' i.e. apply to every value in the vector of M/F</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># values</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>dep_var <span class="op">=</span> bmi.value;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we set up the priors and define the likelihood for the data.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  bayesian model Turing</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  same priors as R/python</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">bayes_bmi</span>(x, y)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># priors</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    α <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">25</span>, <span class="fl">10</span>) <span class="co"># julia allows unicode characters; \alpha + TAB</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    β <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">5</span>) <span class="co"># \beta + TAB</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># +ve only Normal dist for residual var</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">100</span>), lower <span class="op">=</span> <span class="fl">0</span>) <span class="co"># \sigma + TAB</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># likelihood for each y</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(y)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="op">~</span> <span class="fu">Normal</span>((α <span class="op">+</span> β <span class="op">*</span> x[i]), σ)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>bayes_bmi (generic function with 2 methods)</code></pre>
</div>
</div>
<p>We sample from the model we just set up using the <code>NUTS</code> algorithm (the same algorithm used by <code>Stan</code> by default) to create the posterior distribution.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sample; 1000 is burn in; 0.65 is acceptance rate for samples; 3000 samples; 3 chains; MCMCThreads() required to get &gt; 1 chain</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note about threads on Turing.jl guide page: "Be aware that Turing cannot add threads for you – you must have started your Julia instance with multiple threads to experience any kind of parallelism."</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>bayes_bmi_result <span class="op">=</span> <span class="fu">sample</span>(<span class="fu">bayes_bmi</span>(indep_var, dep_var), <span class="fu">NUTS</span>(<span class="fl">1000</span>, <span class="fl">0.65</span>), <span class="fu">MCMCThreads</span>(), <span class="fl">3000</span>, <span class="fl">3</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/F9Hbk/src/sample.jl:296
┌ Info: Found initial step size
└   ϵ = 0.003125
┌ Info: Found initial step size
└   ϵ = 0.0125
┌ Info: Found initial step size
└   ϵ = 0.0125
Sampling (1 threads):  67%|███████████████████▍         |  ETA: 0:00:00Sampling (1 threads): 100%|█████████████████████████████| Time: 0:00:00</code></pre>
</div>
</div>
<p>In the <a href="">python post</a> we used the <code>arviz</code> library <span class="citation" data-cites="kumarArviZUnifiedLibrary2019a">(<a href="#ref-kumarArviZUnifiedLibrary2019a" role="doc-biblioref">Kumar et al. 2019</a>)</span> to visualise and summarise the distributions. The same library is available for <code>julia</code> as <a href="https://julia.arviz.org/stable/"><code>ArviZ.jl</code></a> and it works in much the same way. In order to examine summaries of the posterior distributions we first convert the <code>MCMCChains</code> object from the posterior sampling to an <code>InferenceData</code> object.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to InferenceData object using ArviZ</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>idata_bayes_bmi_result <span class="op">=</span> <span class="fu">from_mcmcchains</span>(bayes_bmi_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>InferenceData<details>
<summary>posterior</summary>
<pre><code>Dataset with dimensions: Dim{:draw}, Dim{:chain}
and 3 layers:
  :α Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :σ Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :β Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)

with metadata Dict{String, Any} with 3 entries:
  "created_at" =&gt; "2023-04-09T17:26:46.465"
  "inference_library_version" =&gt; "6.0.0"
  "inference_library" =&gt; "MCMCChains"</code></pre>
</details>
<details>
<summary>sample_stats</summary>
<pre><code>Dataset with dimensions: Dim{:draw}, Dim{:chain}
and 12 layers:
  :energy           Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :n_steps          Int64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :diverging        Bool dims: Dim{:draw}, Dim{:chain} (3000×3)
  :max_energy_error Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :energy_error     Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :is_accept        Bool dims: Dim{:draw}, Dim{:chain} (3000×3)
  :log_density      Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :tree_depth       Int64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :step_size        Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :acceptance_rate  Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :lp               Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)
  :step_size_nom    Float64 dims: Dim{:draw}, Dim{:chain} (3000×3)

with metadata Dict{String, Any} with 3 entries:
  "created_at" =&gt; "2023-04-09T17:26:45.376"
  "inference_library_version" =&gt; "6.0.0"
  "inference_library" =&gt; "MCMCChains"</code></pre>
</details>
</div>
</div>
</div>
<p>First we examine the posterior distributions with traceplots of the MCMC sampling process to make sure the MCMC chains converged.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_trace</span>(idata_bayes_bmi_result, figsize <span class="op">=</span> (<span class="fl">5</span>,<span class="fl">6</span>)); <span class="co"># bit annoying that diff plot engines use diff units for fig sizes e.g. px vs inches</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="hello_world_data_julia_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>These all look good.</p>
<p>We can then examine summary data. <code>ArviZ.jl</code> uses <code>summarystats()</code> rather than <code>summary()</code> which is used by <code>arviz</code> in <code>python</code>.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary stats</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarystats</span>(idata_bayes_bmi_result, kind <span class="op">=</span> <span class="st">"stats"</span>, hdi_prob <span class="op">=</span> <span class="fl">0.9</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># can also get variables explicitly with var_names = </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summarystats(idata_bayes_bmi_result, var_names = ["α", "β", "σ"], kind = "stats", hdi_prob = 0.9)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div><div style="float: left;"><span>3×5 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sd</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_5%</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_95%</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">α</td>
<td style="text-align: right;">22.834</td>
<td style="text-align: right;">0.318</td>
<td style="text-align: right;">22.31</td>
<td style="text-align: right;">23.344</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">σ</td>
<td style="text-align: right;">2.823</td>
<td style="text-align: right;">0.143</td>
<td style="text-align: right;">2.585</td>
<td style="text-align: right;">3.052</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">β</td>
<td style="text-align: right;">0.826</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.177</td>
<td style="text-align: right;">1.518</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Finally we can use <code>ArviZ</code> to examine more detailed plots of the posterior distributions.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_posterior</span>(idata_bayes_bmi_result, grid<span class="op">=</span>(<span class="fl">2</span>,<span class="fl">2</span>), hdi_prob <span class="op">=</span> <span class="fl">0.9</span>, round_to <span class="op">=</span> <span class="fl">3</span>, figsize <span class="op">=</span> (<span class="fl">8</span>,<span class="fl">5</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="hello_world_data_julia_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In order to assess the full posterior for male BMI we can extract the MCMC chains for the intercept and coefficient for <code>male</code> and add these together. This returns an <code>Array</code> object rather than an <code>MCMCChains</code> object. We convert the <code>Array</code> to an <code>InferenceData</code> object using <code>convert_to_inference_data()</code>.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior for male bmi</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>male_bmi <span class="op">=</span> idata_bayes_bmi_result.posterior[<span class="op">:</span>α] <span class="op">+</span> idata_bayes_bmi_result.posterior[<span class="op">:</span>β]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to InferenceData</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>male_bmi <span class="op">=</span> <span class="fu">convert_to_inference_data</span>(male_bmi)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_posterior</span>(male_bmi, hdi_prob <span class="op">=</span> <span class="fl">0.9</span>, round_to <span class="op">=</span> <span class="fl">3</span>, figsize<span class="op">=</span>(<span class="fl">5</span>,<span class="fl">5</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="hello_world_data_julia_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can generate a summary table as we did above using <code>ArviZ.jl</code>.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarystats</span>(male_bmi, kind <span class="op">=</span> <span class="st">"stats"</span>, hdi_prob <span class="op">=</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div><div style="float: left;"><span>1×5 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sd</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_5%</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_95%</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.661</td>
<td style="text-align: right;">0.262</td>
<td style="text-align: right;">23.232</td>
<td style="text-align: right;">24.084</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>From this analysis we’d conclude that the female BMI averages 22.85 and with 90% probability ranges from 22.34 to 23.37. Male BMI is greater with an average of 23.66 (notably greater than the upper limit of the female 90% HDI) and ranging from 23.23 to 24.08 with 90% probability. These values are contingent on the priors we used.</p>
<p>Using <code>Turing.jl</code> we have to type the model out explicitly. If you’d prefer a formula type interface then the <a href="https://beta.turing.ml/TuringGLM.jl/dev/"><code>TuringGLM.jl</code></a> library can be used to create Bayesian models in a similar manner to <code>brms</code> or <code>rstanarm</code> in R or <code>bambi</code> in python.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>TuringGLM</code> is a work in progress and at the moment has some limitations. For hierarchical models only single random-intercept hierarchical models are supported (so no random slope models).</p>
<p>Currently <code>TuringGLM.jl</code> supports the following likelihoods:</p>
<ul>
<li>Normal (the default if not specified): linear regression</li>
<li>TDist: robust linear regression</li>
<li>Bernoulli: logistic regression</li>
<li>Poisson: count data regression</li>
<li>NegativeBinomial: robust count data regression where there is overdispersion</li>
</ul>
</div>
</div>
<p>As before we first have to define the priors we want (although <code>TuringGLM</code> does provide default priors as well).</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create custom priors</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># turingGLM takes predictors first, then intercept, then auxilliary (e.g. sigma)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://beta.turing.ml/TuringGLM.jl/dev/tutorials/custom_priors/ &amp; ?CustomPrior</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>priors <span class="op">=</span> <span class="fu">CustomPrior</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">5</span>), <span class="fu">Normal</span>(<span class="fl">25</span>, <span class="fl">10</span>), <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">100</span>), lower <span class="op">=</span> <span class="fl">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>CustomPrior(Normal{Float64}(μ=0.0, σ=5.0), Normal{Float64}(μ=25.0, σ=10.0), Truncated(Normal{Float64}(μ=0.0, σ=100.0); lower=0.0))</code></pre>
</div>
</div>
<p>Now we can define the model using a formula interface and <code>TuringGLM</code> will take care of the heavy lifting for us.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bayesian model TuringGLM</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># add intercept to formula</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>frm <span class="op">=</span> <span class="pp">@formula</span>(value <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> sex)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create model (formula, data; priors)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>turing_bmi_bayes <span class="op">=</span> <span class="fu">turing_model</span>(frm, bmi; priors) <span class="co"># formula, data; priors... note comma &amp; semi-colon use</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sample from model as per Turing above</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>turing_bmi_bayes_samples <span class="op">=</span> <span class="fu">sample</span>(turing_bmi_bayes, <span class="fu">NUTS</span>(<span class="fl">1000</span>, <span class="fl">0.65</span>), <span class="fu">MCMCThreads</span>(), <span class="fl">3000</span>, <span class="fl">3</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/F9Hbk/src/sample.jl:296
┌ Info: Found initial step size
└   ϵ = 0.0125
┌ Info: Found initial step size
└   ϵ = 0.003125
┌ Info: Found initial step size
└   ϵ = 0.0125
Sampling (1 threads):  67%|███████████████████▍         |  ETA: 0:00:00Sampling (1 threads): 100%|█████████████████████████████| Time: 0:00:00</code></pre>
</div>
</div>
<p>After converting the <code>MCMCChains</code> object to an <code>InferenceData</code> object we can use <code>ArviZ</code> to summarise &amp; plot the posterior distributions.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to InferenceData object using ArviZ &amp; shpw summary stats</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>idata_turing_bmi_bayes <span class="op">=</span> <span class="fu">from_mcmcchains</span>(turing_bmi_bayes_samples)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary stats; explicit variable selection</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summarystats</span>(idata_turing_bmi_bayes, var_names <span class="op">=</span> [<span class="st">"α"</span>, <span class="st">"β"</span>, <span class="st">"σ"</span>] , kind <span class="op">=</span> <span class="st">"stats"</span>, hdi_prob <span class="op">=</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div><div style="float: left;"><span>3×5 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sd</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_5%</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_95%</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">α</td>
<td style="text-align: right;">22.843</td>
<td style="text-align: right;">0.309</td>
<td style="text-align: right;">22.364</td>
<td style="text-align: right;">23.382</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">β[1]</td>
<td style="text-align: right;">0.818</td>
<td style="text-align: right;">0.402</td>
<td style="text-align: right;">0.151</td>
<td style="text-align: right;">1.465</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">σ</td>
<td style="text-align: right;">2.814</td>
<td style="text-align: right;">0.138</td>
<td style="text-align: right;">2.582</td>
<td style="text-align: right;">3.034</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can plot the posterior distributions.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_posterior</span>(idata_turing_bmi_bayes, grid<span class="op">=</span>(<span class="fl">2</span>,<span class="fl">2</span>), hdi_prob <span class="op">=</span> <span class="fl">0.9</span>, round_to <span class="op">=</span> <span class="fl">3</span>, figsize <span class="op">=</span> (<span class="fl">8</span>,<span class="fl">10</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="hello_world_data_julia_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We calculate the posteriors for male BMI as before by extracting the intercept and beta coefficient MCMC samples and adding them together.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate male bmi posterior</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>turing_male_bmi <span class="op">=</span> idata_turing_bmi_bayes.posterior[<span class="op">:</span>α] <span class="op">+</span> idata_turing_bmi_bayes.posterior[<span class="op">:</span>β] <span class="co"># returns a 3x3000x1 Array, not an MCMCChains object</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to InferenceData</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>idata_turing_male_bmi <span class="op">=</span> <span class="fu">convert_to_inference_data</span>(turing_male_bmi) <span class="co"># function here is convert_to_inference_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>InferenceData<details>
<summary>posterior</summary>
<pre><code>Dataset with dimensions: Dim{:draw}, Dim{:chain}, Dim{:β_dim_1}
and 1 layer:
  : Float64 dims: Dim{:draw}, Dim{:chain}, Dim{:β_dim_1} (3000×3×1)

with metadata Dict{String, Any} with 1 entry:
  "created_at" =&gt; "2023-04-09T17:27:12.686"</code></pre>
</details>
</div>
</div>
</div>
<p>We can summarise and plot the distribtion of male BMI as we did above.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise the posterior</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarystats</span>(idata_turing_male_bmi, kind <span class="op">=</span> <span class="st">"stats"</span>, hdi_prob <span class="op">=</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div><div style="float: left;"><span>1×5 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sd</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_5%</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">hdi_95%</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">[1]</td>
<td style="text-align: right;">23.66</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">23.246</td>
<td style="text-align: right;">24.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we can plot the posterior distribution for male BMI.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the posterior</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_posterior</span>(idata_turing_male_bmi, hdi_prob <span class="op">=</span> <span class="fl">0.9</span>, round_to <span class="op">=</span> <span class="fl">3</span>, figsize <span class="op">=</span> (<span class="fl">5</span>,<span class="fl">5</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="hello_world_data_julia_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>These results are essetially the same as we got from <code>Turing.jl</code> &amp; the results from both Bayesian analyses are essentially the same as those we got from the frequentist analysis.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this post we have used the <code>julia</code> language to load, wrangle, filter and plot some data. We’ve also seen how to do some basic frequentist and Bayesian inference.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-danischMakieJlFlexible2021" class="csl-entry" role="listitem">
Danisch, Simon, and Julius Krumbiegel. 2021. <span>“Makie.jl: <span>Flexible</span> High-Performance Data Visualization for <span>Julia</span>.”</span> <em>Journal of Open Source Software</em> 6 (65): 3349. <a href="https://doi.org/10.21105/joss.03349">https://doi.org/10.21105/joss.03349</a>.
</div>
<div id="ref-geTuringLanguageFlexible2018" class="csl-entry" role="listitem">
Ge, Hong, Kai Xu, and Zoubin Ghahramani. 2018. <span>“Turing: <span>A Language</span> for <span>Flexible Probabilistic Inference</span>.”</span> In <em>Proceedings of the <span>Twenty-First International Conference</span> on <span>Artificial Intelligence</span> and <span>Statistics</span></em>, 1682–90. <span>PMLR</span>.
</div>
<div id="ref-kumarArviZUnifiedLibrary2019a" class="csl-entry" role="listitem">
Kumar, Ravin, Colin Carroll, Ari Hartikainen, and Osvaldo Martin. 2019. <span>“<span>ArviZ</span> a Unified Library for Exploratory Analysis of <span>Bayesian</span> Models in <span>Python</span>.”</span> <em>Journal of Open Source Software</em> 4 (33): 1143. <a href="https://doi.org/10.21105/joss.01143">https://doi.org/10.21105/joss.01143</a>.
</div>
<div id="ref-wickham2014" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (1): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>